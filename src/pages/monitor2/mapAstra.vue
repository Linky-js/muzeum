<script setup>
import { ref, watch } from 'vue';
import MapSceneAstraMonitor from '@/components/maps/MapSceneAstraMonitor.vue';
import RegionModalAstra from '@/components/maps/RegionModalAstra.vue';
import { useBroadcastBus } from '@/composables/useBroadcastBus.js'
import { initMonitorSync } from '@/composables/syncRouterSimple.js'
import { useRouter } from 'vue-router'

const router = useRouter()
const bus = useBroadcastBus({ role: 'monitor', pairId: '2', debug: true })
initMonitorSync(router, bus, '2')
const targetregion = ref(null);
const curRegion = ref(null);
const isModalOpen = ref(false)
let offListener = null

bus.on('navigate', (region) => {
  console.log('navigate', region);
  isModalOpen.value = false
  targetregion.value = region.region
  curRegion.value = region
})
</script>

<template>
  {{ region }}
  <div class="map__wrapper">
    <div class="astrazeneca">
      <div class="logo">
        <svg width="636" height="162" viewBox="0 0 636 162" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M212.928 148.546L212.541 121.494C212.541 121.494 212.695 112.712 206.893 108.243C202.792 105.028 196.525 103.773 191.728 103.773C182.985 103.773 176.872 107.38 173.777 113.183C173.623 113.496 173.468 113.731 173.313 114.045L181.36 117.495C182.211 114.28 184.687 110.673 192.037 110.673C203.643 110.673 203.643 119.847 203.643 125.258V126.591L195.364 127.296C179.89 128.551 174.319 132.08 171.379 136.549C169.831 138.901 169.058 141.646 169.058 144.468C169.058 153.407 176.563 159.445 186.699 159.445C196.602 159.445 201.477 153.721 204.107 150.898C204.339 154.976 205.113 158.661 205.113 158.661H214.243C213.237 156.387 212.928 148.546 212.928 148.546ZM202.405 144.076C199.852 149.565 194.745 151.996 188.633 151.996C182.134 151.996 178.884 148.389 178.884 144.155C178.884 140.47 180.509 136.784 190.18 134.667C195.828 133.413 200.393 132.785 203.798 132.236C203.798 139.921 203.72 141.175 202.405 144.076ZM515.529 148.546L515.142 121.494C515.142 121.494 515.297 112.712 509.494 108.243C505.394 105.028 499.126 103.773 494.329 103.773C485.586 103.773 479.474 107.38 476.379 113.183C476.224 113.496 476.07 113.731 475.915 114.045L483.962 117.495C484.813 114.28 487.289 110.673 494.639 110.673C506.245 110.673 506.245 119.847 506.245 125.258V126.591L497.966 127.296C482.491 128.551 476.921 132.08 473.981 136.549C472.433 138.901 471.659 141.646 471.659 144.468C471.659 153.407 479.164 159.445 489.3 159.445C499.204 159.445 504.078 153.721 506.709 150.898C506.941 154.976 507.715 158.661 507.792 158.661H516.845C515.839 156.387 515.529 148.546 515.529 148.546ZM505.007 144.076C502.453 149.565 497.347 151.996 491.235 151.996C484.735 151.996 481.408 148.389 481.408 144.155C481.408 140.47 483.033 136.784 492.705 134.667C498.353 133.413 502.918 132.785 506.322 132.236C506.477 139.921 506.322 141.175 505.007 144.076ZM398.311 152.937C386.009 153.172 382.372 141.959 382.604 133.177H420.052C420.052 130.982 420.052 126.904 419.046 122.435C415.952 109.184 406.822 103.852 397.228 103.852C386.241 103.852 373.32 111.457 373.32 131.295C373.32 149.016 382.14 159.68 397.537 159.68C408.833 159.68 414.636 153.799 417.576 148.624L409.066 146.978C406.899 150.506 403.34 152.78 398.311 152.937ZM396.531 110.595C401.793 110.595 409.607 112.947 410.381 126.748H382.759C383.765 116.162 389.104 110.595 396.531 110.595ZM298.965 152.937C286.663 153.172 283.027 141.959 283.259 133.177H320.707C320.707 130.982 320.707 126.904 319.701 122.435C316.606 109.184 307.476 103.852 297.882 103.852C286.895 103.852 273.974 111.457 273.974 131.295C273.974 149.016 282.794 159.68 298.191 159.68C309.565 159.68 315.291 153.799 318.231 148.624L309.72 146.978C307.476 150.506 303.994 152.78 298.965 152.937ZM297.186 110.595C302.447 110.595 310.262 112.947 311.035 126.748H283.413C284.419 116.162 289.681 110.595 297.186 110.595ZM449.454 152.858C443.573 152.858 433.67 149.095 433.67 131.687C433.67 126.983 434.521 110.438 448.835 110.438C456.108 110.438 459.435 114.437 460.982 117.887L469.184 114.437C464.154 105.89 455.024 103.93 448.525 103.93C431.968 103.93 423.921 117.495 423.921 132.393C423.921 145.331 430.884 159.68 449.299 159.68C459.976 159.68 465.857 154.427 469.184 149.252L461.446 145.958C459.589 149.565 456.185 152.858 449.454 152.858ZM367.749 116.476C365.196 107.772 357.226 104.4 350.65 104.4C347.555 104.4 339.276 105.185 334.402 113.81V106.126H325.659V158.582H334.402V128.629C334.402 124.709 334.402 120.71 338.27 116.789C341.056 113.967 344.383 112.79 348.251 112.79C352.971 112.79 357.845 114.986 359.393 120.004C359.934 121.808 359.934 123.376 359.934 128.708V158.582H368.677V127.296C368.677 122.827 368.677 119.612 367.749 116.476ZM231.11 150.271L269.873 97.8139V89.1888H220.51V97.7356H259.428L220.51 149.565V158.582H270.879V150.271H231.11ZM150.953 115.221V105.733H142.21V158.504H150.953V134.275C150.953 129.727 150.798 124.395 153.196 120.553C156.059 115.848 160.237 114.045 168.826 114.045V104.871C165.266 105.028 155.904 105.263 150.953 115.221ZM134.318 113.026V105.655H124.878V89.1888L115.826 93.0309V105.655H107.547V113.026H115.826V147.056C115.748 153.956 115.748 158.896 125.884 158.896C129.211 158.896 132.848 158.19 134.395 158.034V150.741C132.616 151.29 130.294 151.996 128.67 151.996C124.956 151.996 124.956 149.33 124.956 143.057V113.026H134.318ZM84.1807 126.748C78.6099 125.65 72.1107 123.533 72.1107 118.514C72.1107 114.986 75.515 110.83 82.4011 110.83C89.442 110.83 93.6201 115.692 94.239 117.574L102.363 114.123C98.6492 106.91 91.2215 104.008 83.407 104.008C71.3369 104.008 63.3676 110.046 63.3676 119.612C63.3676 130.511 72.5749 132.628 81.4727 134.589C89.1325 136.314 96.5602 138.196 96.5602 144.155C96.5602 149.8 91.9952 152.78 84.258 152.78C77.9909 152.78 73.8128 150.977 71.4917 146.899L62.2844 148.546C65.9209 155.995 73.3486 159.602 83.9486 159.602C98.2624 159.602 105.767 151.604 105.767 143.057C105.69 132.08 95.7091 129.1 84.1807 126.748ZM35.5911 89.1104H26.0743L0 158.582H9.67149L17.3313 137.333H43.4057L50.8334 158.582H60.4275L35.5911 89.1104ZM20.2714 129.492L30.7167 100.637L40.6976 129.492H20.2714Z"
            fill="white" />
          <path
            d="M594.372 59.3135C593.211 48.5712 598.55 -16.5098 569.071 3.95543C550.502 19.6376 523.422 52.8838 512.513 74.1332C508.412 82.5232 513.131 84.0914 519.631 88.2472L520.404 88.6392L539.283 98.5974L558.085 108.948L572.089 116.946C557.156 125.336 521.488 158.503 559.787 161.012C570.464 160.542 610.388 152.779 616.655 144.938C617.738 143.37 617.816 141.723 616.887 139.998L615.959 138.665L614.876 137.568L613.87 136.783L605.359 131.53L594.836 125.257C640.563 95.5393 658.359 77.7401 594.372 59.3135ZM578.279 54.6089L565.358 51.5509L553.288 49.5122L549.419 49.2769C576.035 23.0877 575.184 12.1886 578.279 54.6089ZM598.55 133.098L602.806 135.999L605.668 138.273L606.829 139.449L607.68 140.469V140.547V140.626V140.704L607.603 140.782L607.448 140.861L568.685 143.919L570.309 142.351L578.588 136.078L590.658 127.766L598.55 133.098ZM611.626 88.404L611.394 88.9528L610.465 90.2074L607.061 93.1871L602.728 96.4803L597.003 100.479L575.803 114.28L544.545 96.1667L527.368 85.738L523.035 82.6016L522.416 81.9743L521.72 80.7197C521.178 79.0731 523.113 76.8776 524.118 75.8582L542.842 56.4907C554.216 82.4447 590.736 139.763 593.753 76.015L601.568 79.7004L608.918 84.013L610.775 85.5812L611.549 86.8358L611.703 87.5415L611.626 88.404Z"
            fill="white" />
        </svg>

      </div>
      <div class="text">
        Масштаб исследований хронической <br>болезни сердца по регионам России.
      </div>
    </div>
    <MapSceneAstraMonitor :targetregion="targetregion" :bg="true" @showmodal="isModalOpen = true" />
  </div>
  <RegionModalAstra v-if="curRegion" :show="isModalOpen" :region="curRegion?.region" />
</template>
<style scoped>
.map__wrapper {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

.astrazeneca {
  position: fixed;
  top: 11.69rem;
  left: 18.37rem;
  z-index: 3;
  display: flex;
  flex-direction: column;
  gap: 60px;
}

.astrazeneca .logo {
  width: 636px;
  height: 161.012px;
}

.text {
  color: #FFF;

  /* Map screen  6144 text styles/Region main text */
  font-family: "TT Hoves";
  font-size: 48px;
  font-style: normal;
  font-weight: 400;
  line-height: 60px;
  /* 125% */
  letter-spacing: 0.96px;
}
</style>
